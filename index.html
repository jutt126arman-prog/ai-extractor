<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Design Extractor - Ø®ÙˆØ¯Ú©Ø§Ø± ÚˆÛŒØ²Ø§Ø¦Ù† Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', sans-serif;
        }

        body {
            background: #0a0a0a;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #1a1a1a;
            border-radius: 20px;
            padding: 30px;
            border: 1px solid #333;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #00ff88;
            margin-bottom: 10px;
        }

        .header p {
            color: #aaa;
            font-size: 1.1rem;
        }

        /* Upload Box */
        .upload-box {
            border: 3px dashed #444;
            border-radius: 15px;
            padding: 50px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s;
            background: #222;
        }

        .upload-box:hover {
            border-color: #00ff88;
            background: #252525;
        }

        .upload-box.dragover {
            border-color: #0088ff;
            background: #1a2a3a;
        }

        .upload-icon {
            font-size: 70px;
            margin-bottom: 20px;
            color: #00ff88;
        }

        .upload-text h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: white;
        }

        .upload-text p {
            color: #888;
        }

        #fileInput {
            display: none;
        }

        /* Preview */
        .preview-section {
            display: none;
            margin: 30px 0;
            text-align: center;
        }

        .preview-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: white;
        }

        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            border: 3px solid #333;
        }

        /* Process Button */
        .process-btn {
            background: linear-gradient(90deg, #00ff88, #0088ff);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            display: block;
            margin: 30px auto;
            transition: all 0.3s;
        }

        .process-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
        }

        .process-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Results */
        .results-section {
            display: none;
            margin-top: 40px;
        }

        .results-title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 30px;
            color: #00ff88;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .result-box {
            background: #222;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid #333;
        }

        .result-box h3 {
            color: #0088ff;
            margin-bottom: 15px;
        }

        .result-image {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 10px;
            background: #000;
        }

        /* Download */
        .download-section {
            text-align: center;
            margin-top: 40px;
        }

        .download-btn {
            display: inline-block;
            background: #ff3366;
            color: white;
            padding: 15px 40px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            margin: 10px;
            transition: all 0.3s;
        }

        .download-btn:hover {
            transform: scale(1.05);
            background: #ff5588;
        }

        /* API Key Section */
        .api-section {
            background: #222;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .api-input {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #333;
            background: #111;
            color: white;
            font-size: 1rem;
            margin-top: 10px;
        }

        .api-input:focus {
            border-color: #00ff88;
            outline: none;
        }

        /* Instructions */
        .instructions {
            background: #222;
            border-radius: 15px;
            padding: 25px;
            margin-top: 40px;
        }

        .instructions h3 {
            color: #00ff88;
            margin-bottom: 20px;
            text-align: center;
        }

        .instruction-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .step {
            text-align: center;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 10px;
        }

        .step-number {
            background: #0088ff;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-weight: bold;
        }

        .step p {
            color: #aaa;
            font-size: 0.9rem;
        }

        /* Error Message */
        .error-message {
            background: #ff3333;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ¤– Auto Design Extractor</h1>
            <p>Ú©ÙˆØ¦ÛŒ Ø¨Ú¾ÛŒ Mockup Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚºØŒ AI Ø®ÙˆØ¯Ú©Ø§Ø± Ø·ÙˆØ± Ù¾Ø± ÚˆÛŒØ²Ø§Ø¦Ù† Ø§Ù„Ú¯ Ú©Ø± Ø¯Û’ Ú¯Ø§</p>
        </div>

        <!-- API Key Section -->
        <div class="api-section" id="apiSection">
            <h3>ğŸ”‘ API Key Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº</h3>
            <p>Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø§Ù¾Ù†ÛŒ Replicate API Key Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº:</p>
            <input type="password" 
                   class="api-input" 
                   id="apiKeyInput" 
                   placeholder="r8_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
            <button class="process-btn" onclick="saveAPIKey()" style="margin-top: 15px; padding: 12px 30px; font-size: 1rem;">
                âœ… Ø³ÛŒÙˆ Ú©Ø±ÛŒÚº
            </button>
            <p style="color: #aaa; font-size: 0.9rem; margin-top: 10px;">
                <a href="https://replicate.com/signup" target="_blank" style="color: #00ff88;">
                    Ù…ÙØª API Key Ø­Ø§ØµÙ„ Ú©Ø±ÛŒÚº
                </a>
            </p>
        </div>

        <!-- Upload Box -->
        <div class="upload-box" id="uploadBox">
            <div class="upload-icon">ğŸ“¤</div>
            <div class="upload-text">
                <h3>Mockup Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</h3>
                <p>Ú©Ù„Ú© Ú©Ø±ÛŒÚº ÛŒØ§ ØªØµÙˆÛŒØ± ÚˆØ±ÛŒÚ¯ Ø§ÛŒÙ†Úˆ ÚˆØ±Ø§Ù¾ Ú©Ø±ÛŒÚº</p>
                <p style="color: #888; margin-top: 10px;">PNG, JPG, JPEG (Max 10MB)</p>
            </div>
        </div>
        <input type="file" id="fileInput" accept="image/*">

        <!-- Error Message -->
        <div class="error-message" id="errorMessage"></div>

        <!-- Preview -->
        <div class="preview-section" id="previewSection">
            <div class="preview-title">Ø¢Ù¾ Ú©Ø§ Mockup:</div>
            <img id="previewImage" class="preview-image" alt="Preview">
        </div>

        <!-- Process Button -->
        <button class="process-btn" id="processBtn" disabled>
            ğŸ¤– ÚˆÛŒØ²Ø§Ø¦Ù† Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº
        </button>

        <!-- Results -->
        <div class="results-section" id="resultsSection">
            <div class="results-title">ğŸ‰ ÚˆÛŒØ²Ø§Ø¦Ù† Ø§Ù„Ú¯ ÛÙˆ Ú¯ÛŒØ§!</div>
            
            <div class="results-grid">
                <div class="result-box">
                    <h3>Ø§ØµÙ„ Mockup</h3>
                    <img id="originalImage" class="result-image" alt="Original">
                </div>
                <div class="result-box">
                    <h3>Ø§Ù„Ú¯ Ø´Ø¯Û ÚˆÛŒØ²Ø§Ø¦Ù†</h3>
                    <img id="extractedDesign" class="result-image" alt="Extracted">
                </div>
            </div>

            <div class="download-section">
                <a href="#" id="downloadBtn" class="download-btn" download="design.png">
                    â¬‡ï¸ PNG ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
                </a>
                <button class="download-btn" onclick="resetApp()" style="background: #333;">
                    ğŸ”„ Ù†ÛŒØ§ Mockup
                </button>
            </div>
        </div>

        <!-- Instructions -->
        <div class="instructions">
            <h3>ğŸš€ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û</h3>
            <div class="instruction-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <p>Ù…ÙØª API Key Ø­Ø§ØµÙ„ Ú©Ø±ÛŒÚº</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <p>Mockup ØªØµÙˆÛŒØ± Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <p>AI Ø®ÙˆØ¯Ú©Ø§Ø± ÚˆÛŒØ²Ø§Ø¦Ù† Ø§Ù„Ú¯ Ú©Ø±Û’ Ú¯Ø§</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <p>Ø´ÙØ§Ù PNG ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Elements
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');
        const previewSection = document.getElementById('previewSection');
        const previewImage = document.getElementById('previewImage');
        const processBtn = document.getElementById('processBtn');
        const resultsSection = document.getElementById('resultsSection');
        const errorMessage = document.getElementById('errorMessage');
        const apiSection = document.getElementById('apiSection');

        // State
        let uploadedImage = null;
        let apiKey = localStorage.getItem('replicate_api_key');

        // Check API Key on load
        window.onload = function() {
            if (!apiKey) {
                apiSection.style.display = 'block';
                showError('Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾ÛÙ„Û’ API Key Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº');
            } else {
                showMessage('âœ… API Key Ø³ÛŒÙˆ ÛÙˆ Ú¯Ø¦ÛŒ ÛÛ’! Ø§Ø¨ Ø¢Ù¾ Mockup Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ”');
            }
        };

        // Save API Key
        function saveAPIKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (!key) {
                showError('Ø¨Ø±Ø§Û Ú©Ø±Ù… API Key Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº');
                return;
            }

            if (!key.startsWith('r8_')) {
                showError('ØºÙ„Ø· API Key ÙØ§Ø±Ù…ÛŒÙ¹Û” ÛŒÛ r8_ Ø³Û’ Ø´Ø±ÙˆØ¹ ÛÙˆÙ†ÛŒ Ú†Ø§ÛÛŒÛ’');
                return;
            }

            localStorage.setItem('replicate_api_key', key);
            apiKey = key;
            apiSection.style.display = 'none';
            showMessage('âœ… API Key Ø³ÛŒÙˆ ÛÙˆ Ú¯Ø¦ÛŒ ÛÛ’! Ø§Ø¨ Ø¢Ù¾ Mockup Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ”');
        }

        // File Upload
        uploadBox.addEventListener('click', () => fileInput.click());
        
        // Drag and Drop
        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('dragover');
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('dragover');
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleFile(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFile(file);
        });

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showError('Ø¨Ø±Ø§Û Ú©Ø±Ù… ØµØ±Ù ØªØµÙˆÛŒØ±ÛŒ ÙØ§Ø¦Ù„ Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                showError('ÙØ§Ø¦Ù„ Ø³Ø§Ø¦Ø² 10MB Ø³Û’ Ø²ÛŒØ§Ø¯Û Ù†ÛÛŒÚº ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                uploadedImage = e.target.result;
                previewImage.src = uploadedImage;
                previewSection.style.display = 'block';
                processBtn.disabled = false;
                
                // Update upload box
                uploadBox.innerHTML = `
                    <div class="upload-icon">âœ…</div>
                    <div class="upload-text">
                        <h3 style="color: #00ff88;">Mockup Ø§Ù¾ Ù„ÙˆÚˆ ÛÙˆ Ú¯ÛŒØ§!</h3>
                        <p>Ø§Ø¨ "ÚˆÛŒØ²Ø§Ø¦Ù† Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº" Ø¨Ù¹Ù† Ø¯Ø¨Ø§Ø¦ÛŒÚº</p>
                        <p style="color: #888; margin-top: 10px;">${file.name} (${(file.size/1024/1024).toFixed(2)} MB)</p>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        // Process Button
        processBtn.addEventListener('click', async () => {
            if (!uploadedImage || !apiKey) return;

            // Show loading
            processBtn.disabled = true;
            processBtn.innerHTML = 'âš¡ AI Ú©Ø§Ù… Ú©Ø± Ø±ÛØ§ ÛÛ’...';

            try {
                // Convert base64 to blob
                const base64Response = await fetch(uploadedImage);
                const blob = await base64Response.blob();

                // Create FormData
                const formData = new FormData();
                formData.append('image', blob, 'mockup.png');

                // Call Replicate API (Background Removal)
                const result = await callReplicateAPI(blob);
                
                if (result && result.output) {
                    // Show results
                    document.getElementById('originalImage').src = uploadedImage;
                    document.getElementById('extractedDesign').src = result.output;
                    document.getElementById('downloadBtn').href = result.output;
                    resultsSection.style.display = 'block';
                    
                    // Scroll to results
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                    
                    // Reset button
                    processBtn.innerHTML = 'ğŸ¤– ÚˆÛŒØ²Ø§Ø¦Ù† Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº';
                    processBtn.disabled = false;
                } else {
                    throw new Error('AI Ù†Û’ ÚˆÛŒØ²Ø§Ø¦Ù† Ù†ÛÛŒÚº Ù†Ú©Ø§Ù„Ø§');
                }

            } catch (error) {
                showError('AI Ù¾Ø±ÙˆØ³ÛŒØ³Ù†Ú¯ Ù…ÛŒÚº Ø®Ø±Ø§Ø¨ÛŒ: ' + error.message);
                processBtn.innerHTML = 'ğŸ¤– ÚˆÛŒØ²Ø§Ø¦Ù† Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº';
                processBtn.disabled = false;
            }
        });

        // Call Replicate API (Background Removal - CLIPSeg)
        async function callReplicateAPI(imageBlob) {
            try {
                // Convert blob to base64
                const base64 = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(imageBlob);
                });

                // Remove data URL prefix
                const base64Data = base64.split(',')[1];

                // Replicate API call for background removal
                const response = await fetch('https://api.replicate.com/v1/predictions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Token ${apiKey}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        version: "fb8af171cfa1616ddcf1242c093f9c46bcada5ad4cf6f2fbe8b81b330ec5c003", // Background removal model
                        input: {
                            image: base64Data,
                            model: "u2net", // Best for design extraction
                            a_prompt: "clean product design, transparent background",
                            n_prompt: "text, watermark, background, person, body",
                            ddim_steps: 20,
                            scale: 7.5
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('API Error: ' + response.statusText);
                }

                const data = await response.json();
                
                // Poll for result
                let result = null;
                let attempts = 0;
                const maxAttempts = 30;

                while (attempts < maxAttempts) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    const statusResponse = await fetch(data.urls.get, {
                        headers: {
                            'Authorization': `Token ${apiKey}`
                        }
                    });
                    
                    const statusData = await statusResponse.json();
                    
                    if (statusData.status === 'succeeded') {
                        result = statusData.output;
                        break;
                    } else if (statusData.status === 'failed') {
                        throw new Error('AI Ù¾Ø±ÙˆØ³ÛŒØ³Ù†Ú¯ Ù†Ø§Ú©Ø§Ù…');
                    }
                    
                    attempts++;
                }

                if (!result) {
                    throw new Error('Ù¹Ø§Ø¦Ù… Ø¢Ø¤Ù¹: AI Ù†Û’ Ø¬ÙˆØ§Ø¨ Ù†ÛÛŒÚº Ø¯ÛŒØ§');
                }

                return { output: result };

            } catch (error) {
                // Fallback: Use simple canvas processing
                console.log('Using fallback method');
                return await fallbackExtraction(imageBlob);
            }
        }

        // Fallback method (simple extraction)
        async function fallbackExtraction(imageBlob) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    // Draw image
                    ctx.drawImage(img, 0, 0);
                    
                    // Get image data
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    
                    // Simple background removal (for demo)
                    const bgColor = [data[0], data[1], data[2]]; // Sample first pixel
                    
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        // Check if pixel is similar to background
                        const diff = Math.abs(r - bgColor[0]) + 
                                   Math.abs(g - bgColor[1]) + 
                                   Math.abs(b - bgColor[2]);
                        
                        if (diff < 100) {
                            data[i + 3] = 0; // Make transparent
                        }
                    }
                    
                    ctx.putImageData(imageData, 0, 0);
                    
                    // Convert to data URL
                    const result = canvas.toDataURL('image/png');
                    resolve({ output: result });
                };
                
                img.src = URL.createObjectURL(imageBlob);
            });
        }

        // Utility functions
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 5000);
        }

        function showMessage(message) {
            errorMessage.style.background = '#00ff88';
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            setTimeout(() => {
                errorMessage.style.display = 'none';
                errorMessage.style.background = '#ff3333';
            }, 3000);
        }

        function resetApp() {
            // Reset everything
            uploadedImage = null;
            previewSection.style.display = 'none';
            resultsSection.style.display = 'none';
            processBtn.disabled = true;
            fileInput.value = '';
            
            // Reset upload box
            uploadBox.innerHTML = `
                <div class="upload-icon">ğŸ“¤</div>
                <div class="upload-text">
                    <h3>Mockup Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</h3>
                    <p>Ú©Ù„Ú© Ú©Ø±ÛŒÚº ÛŒØ§ ØªØµÙˆÛŒØ± ÚˆØ±ÛŒÚ¯ Ø§ÛŒÙ†Úˆ ÚˆØ±Ø§Ù¾ Ú©Ø±ÛŒÚº</p>
                    <p style="color: #888; margin-top: 10px;">PNG, JPG, JPEG (Max 10MB)</p>
                </div>
            `;
        }

        // Instructions
        alert(`ğŸš€ AI Design Extractor Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±Ù†Û’ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û:

1. Ù¾ÛÙ„Û’ Replicate.com Ù¾Ø± Ø¬Ø§Ø¦ÛŒÚº Ø§ÙˆØ± Ù…ÙØª Ø§Ú©Ø§Ø¤Ù†Ù¹ Ø¨Ù†Ø§Ø¦ÛŒÚº
2. API Key Ú©Ø§Ù¾ÛŒ Ú©Ø±ÛŒÚº (r8_...)
3. Ø§ÙˆÙ¾Ø± ÙˆØ§Ù„Û’ Ø¨Ø§Ú©Ø³ Ù…ÛŒÚº API Key Ù¾ÛŒØ³Ù¹ Ú©Ø±ÛŒÚº
4. Ø§Ù¾Ù†Ø§ Mockup Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº
5. "ÚˆÛŒØ²Ø§Ø¦Ù† Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº" Ø¨Ù¹Ù† Ø¯Ø¨Ø§Ø¦ÛŒÚº
6. AI Ø¢Ù¾ Ú©Ø§ ÚˆÛŒØ²Ø§Ø¦Ù† PNG Ù…ÛŒÚº Ø¯Û’ Ø¯Û’ Ú¯Ø§

ğŸ”— Replicate Signup: https://replicate.com/signup`);
    </script>
</body>
</html>
